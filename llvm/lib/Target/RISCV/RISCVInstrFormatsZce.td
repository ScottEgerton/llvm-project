//===-- RISCVInstrFormatsZce.td - RISCV Zce Instruction Formats --*- tablegen -*-=//
//
// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
//===----------------------------------------------------------------------===//
//
//  This file describes the RISC-V Zce extension instruction formats.
//
//===----------------------------------------------------------------------===//

let hasSideEffects = 0, mayLoad = 0, mayStore = 0 in
class RVZcecInst16<bits<2> funct2, bits<3> opcode, string opcodestr>
    : RVInst16<(outs GPRC:$rs_wb), (ins GPRC:$rs), opcodestr, "$rs", [], InstFormatCR> {
  bits<3> rs;
  let Constraints = "$rs = $rs_wb";

  let Inst{15-13} = 0b100;
  let Inst{12-10} = 0b001;
  let Inst{9-7} = rs;
  let Inst{6-5} = funct2;
  let Inst{4-2} = opcode;
  let Inst{1-0} = 0b00;
}

let hasSideEffects = 0, mayLoad = 0, mayStore = 0 in
class RVZcecInstC_MUL<bits<2> funct2, string opcodestr>
    : RVInst16<(outs GPRC:$rs1_wb), (ins GPRC:$rs1, GPRC:$rs2), opcodestr, "$rs1, $rs2", [], InstFormatCR> {
  bits<3> rs1;
  bits<3> rs2;
  let Constraints = "$rs1 = $rs_wb";

  let Inst{15-13} = 0b100;
  let Inst{12-10} = 0b001;
  let Inst{9-7} = rs1;
  let Inst{6-5} = funct2;
  let Inst{4-2} = rs2;
  let Inst{1-0} = 0b00;
}

class RVInstZceI<bits<3> funct3_2, bits<3> funct3, bits<7> opcode, dag outs, dag ins,
              string opcodestr, string argstr>
    : RVInst<outs, ins, opcodestr, argstr, [], InstFormatI> {
  bits<17> imm;
  bits<5> rd;
  bits<5> rs1;

  let Inst{31-29} = funct3_2;
  let Inst{28-22} = imm{8-2};
  let Inst{21-20} = imm{10-9};
  let Inst{19-15} = imm{15-11};
  let Inst{14-12} = funct3;
  let Inst{11-7} = rd;
  let Inst{6-0} = opcode;
}

class RVInstZceS<bits<3> funct3_2, bits<3> funct3, bits<7> opcode, dag outs, dag ins,
              string opcodestr, string argstr>
    : RVInst<outs, ins, opcodestr, argstr, [], InstFormatS> {
  bits<17> imm;
  bits<5> rs1;
  bits<5> rs2;

  let Inst{31-29} = funct3_2;
  let Inst{28-25} = imm{8-5};
  let Inst{24-20} = rs2;
  let Inst{19-15} = imm{15-11};
  let Inst{14-12} = funct3;
  let Inst{11-9} = imm{4-2};
  let Inst{8-7} = imm{10-9};
  let Inst{6-0} = opcode;
}
